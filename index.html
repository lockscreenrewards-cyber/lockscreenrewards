<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>lock screen rewards — ألعاب</title>
  <meta name="description" content="https://gamemonetize.com/feed.php?format=0&links=0&page=1"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .line-clamp-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .line-clamp-3{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
    .glass{backdrop-filter:saturate(180%) blur(10px);background-color:rgba(255,255,255,.65)}
    .scrollbar::-webkit-scrollbar{height:8px;width:8px}.scrollbar::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:8px}
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <!-- ======= رأس الصفحة ======= -->
  <header class="sticky top-0 z-50 glass border-b border-slate-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center gap-4">
      <div class="w-10 h-10 rounded-2xl bg-gradient-to-br from-indigo-500 to-fuchsia-500"></div>
      <div>
        <h1 class="text-2xl font-extrabold tracking-tight">lock screen rewards</h1>
        <p class="text-sm text-slate-600">ألعاب HTML5 مباشرة من GameMonetize — الأرباح تُنسب لحسابك عند استخدام رابط الـ Feed الخاص بك.</p>
      </div>
      <div class="ms-auto flex items-center gap-3 text-sm">
        <a class="text-slate-600 hover:text-slate-900 underline" target="_blank" rel="noopener" href="https://gamemonetize.com">لوحة GameMonetize</a>
      </div>
    </div>
  </header>

  <!-- ======= أدوات التحكم ======= -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-6">
    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 lg:p-6">
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 items-end">
        <div class="lg:col-span-6">
          <label class="block text-sm font-medium mb-1">رابط الـ Feed الخاص بحسابك (انسخه من لوحة GameMonetize)</label>
          <input id="feedUrl" type="text" class="w-full rounded-xl border-slate-300 focus:ring-indigo-500 focus:border-indigo-500" placeholder="مثال: https://gamemonetize.com/feed.php?format=0&links=0&page=1" />
          <p class="text-xs text-slate-500 mt-1">استخدم دائمًا الرابط الذي تُنشئه من حسابك لضمان تتبّع الأرباح لدوّنك. يمكنك حفظه محليًا؛ لن يُرسل لأحد.</p>
        </div>
        <div class="lg:col-span-2">
          <label class="block text-sm font-medium mb-1">التصنيف</label>
          <select id="category" class="w-full rounded-xl border-slate-300 focus:ring-indigo-500 focus:border-indigo-500">
            <option value="">الكل</option>
            <option>.IO</option>
            <option>2 Player</option>
            <option>3D</option>
            <option>Bejeweled</option>
            <option>Boys</option>
            <option>Clicker</option>
            <option>Cooking</option>
            <option>Girls</option>
            <option>Multiplayer</option>
            <option>Puzzle</option>
            <option>Shooting</option>
            <option>Racing</option>
            <option>Soccer</option>
            <option>Sports</option>
            <option>Stickman</option>
          </select>
        </div>
        <div class="lg:col-span-2">
          <label class="block text-sm font-medium mb-1">المنصة</label>
          <select id="platform" class="w-full rounded-xl border-slate-300 focus:ring-indigo-500 focus:border-indigo-500">
            <option value="">الكل</option>
            <option>WebGL</option>
            <option>HTML5</option>
            <option>Mobile</option>
            <option>Desktop</option>
          </select>
        </div>
        <div class="lg:col-span-2">
          <label class="block text-sm font-medium mb-1">عدد/صفحة</label>
          <select id="perPage" class="w-full rounded-xl border-slate-300 focus:ring-indigo-500 focus:border-indigo-500">
            <option selected>12</option>
            <option>24</option>
            <option>36</option>
            <option>48</option>
          </select>
        </div>
        <div class="lg:col-span-12 flex gap-3 pt-2">
          <button id="apply" class="px-4 py-2 rounded-xl bg-indigo-600 text-white font-semibold hover:bg-indigo-700">تطبيق</button>
          <button id="reset" class="px-4 py-2 rounded-xl bg-slate-100 text-slate-800 font-semibold hover:bg-slate-200">إعادة تعيين</button>
          <div class="ms-auto text-xs text-slate-500">تلميح: سنحفظ رابطك في المتصفح حتى لا تُعيد لصقه.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ======= الشبكة ======= -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-6">
    <div id="status" class="hidden mb-4 p-3 rounded-xl bg-amber-50 text-amber-800 border border-amber-200 text-sm"></div>
    <div id="grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4"></div>

    <div class="flex justify-between items-center mt-6">
      <button id="prev" class="px-4 py-2 rounded-xl bg-slate-100 text-slate-800 border hover:bg-slate-200 disabled:opacity-40">السابق</button>
      <div class="text-sm text-slate-600"><span id="pageLabel">صفحة 1</span></div>
      <button id="next" class="px-4 py-2 rounded-xl bg-slate-100 text-slate-800 border hover:bg-slate-200 disabled:opacity-40">التالي</button>
    </div>
  </main>

  <!-- ======= نافذة تشغيل اللعبة ======= -->
  <div id="player" class="fixed inset-0 hidden items-center justify-center bg-black/70 p-2 md:p-6">
    <div class="bg-white rounded-2xl w-full h-full max-w-7xl shadow-xl overflow-hidden flex flex-col">
      <div class="flex items-center justify-between p-3 border-b">
        <h3 id="playerTitle" class="text-base md:text-lg font-bold truncate">تشغيل اللعبة</h3>
        <div class="flex items-center gap-2">
          <a id="openInNew" target="_blank" rel="noopener" class="px-3 py-1 rounded-lg border text-sm hover:bg-slate-50">فتح في تبويب</a>
          <button id="closePlayer" class="w-9 h-9 inline-flex items-center justify-center rounded-xl bg-slate-100 hover:bg-slate-200">×</button>
        </div>
      </div>
      <iframe id="gameFrame" class="w-full flex-1" allow="fullscreen *; autoplay; clipboard-read; clipboard-write; gamepad; xr-spatial-tracking" referrerpolicy="no-referrer"></iframe>
    </div>
  </div>

  <script>
    // ===== إعدادات =====
    const DEFAULT_FEED = 'https://gamemonetize.com/feed.php?format=0&links=0&page=1'; // استبدله برابطك إن شئت
    const USE_PROXY = false; // لو ظهر خطأ CORS اجعله true واستخدم ملف gm-feed-proxy.php الموضّح أدناه
    const PROXY_URL = '/gm-feed-proxy.php';

    // ملاحظة بروكسي (اختياري على خادمك):
    /*
    <?php // gm-feed-proxy.php
      header('Content-Type: application/json; charset=UTF-8');
      $qs = $_SERVER['QUERY_STRING'];
      $feed = isset($_GET['__feed']) ? $_GET['__feed'] : '';
      if($feed){ $url = $feed . (strpos($feed,'?')!==false ? '&' : '?') . $qs; $url = preg_replace('/[&?]__feed=[^&]*/','',$url); }
      else { $url = 'https://gamemonetize.com/feed.php' . ($qs?('?'.$qs):''); }
      $ch=curl_init($url); curl_setopt($ch,CURLOPT_RETURNTRANSFER,true); $out=curl_exec($ch); $status=curl_getinfo($ch,CURLINFO_HTTP_CODE); curl_close($ch);
      http_response_code($status?:200); echo $out; // يُعيد JSON كما هو
    ?>
    */

    // الحالة العامة
    const state = { page: 1, perPage: 12, category: '', platform: '' };

    // عناصر DOM
    const el = id => document.getElementById(id);
    const grid = el('grid');

    // حفظ/قراءة رابط المستخدم محليًا
    const feedInput = el('feedUrl');
    const saved = localStorage.getItem('gm_feed');
    feedInput.value = 'https://gamemonetize.com/feed.php?format=0&links=0&page=1';

    function parseFeedBase(){
      // يسمح بوضع رابط كامل من لوحتك؛ سنحافظ على معاييره ونعدل page/count/category/platform فقط
      try{ return new URL(feedInput.value.trim()); }catch(e){ return new URL(DEFAULT_FEED); }
    }

    function buildFeedUrl(){
      const base = parseFeedBase();
      const p = base.searchParams;
      p.set('format','0'); // JSON
      p.set('page', String(state.page));
      p.set('count', String(state.perPage));
      if(state.category) p.set('category', state.category); else p.delete('category');
      if(state.platform) p.set('platform', state.platform); else p.delete('platform');
      base.search = p.toString();
      if(USE_PROXY){
        const proxy = new URL(PROXY_URL, location.origin);
        // نمرر رابط الـfeed كـ __feed ليعمل مع البروكسي
        proxy.search = base.search + '&__feed=' + encodeURIComponent(base.origin + base.pathname);
        return proxy.href;
      }
      return base.href;
    }

    function skeleton(n=8){
      grid.innerHTML = Array.from({length:n}).map(()=>`
        <div class="animate-pulse bg-white rounded-2xl border border-slate-200 overflow-hidden">
          <div class="h-40 bg-slate-200"></div>
          <div class="p-3 space-y-2">
            <div class="h-4 bg-slate-200 rounded"></div>
            <div class="h-4 bg-slate-100 rounded w-1/2"></div>
          </div>
        </div>
      `).join('');
    }

    function showStatus(msg, type='info'){
      const box = document.getElementById('status');
      box.textContent = msg; box.classList.remove('hidden');
      box.className = `mb-4 p-3 rounded-xl border text-sm ${type==='error'?'bg-rose-50 text-rose-800 border-rose-200':'bg-amber-50 text-amber-800 border-amber-200'}`;
    }
    function hideStatus(){ document.getElementById('status').classList.add('hidden'); }

    function render(items){
      if(!items || !items.length){
        grid.innerHTML = `<div class='col-span-full text-center text-slate-600'>لا توجد ألعاب مطابقة.</div>`; return;
      }
      grid.innerHTML = items.map(g=>{
        const title = g.title || 'بدون اسم';
        const img = g.thumb || g.image || '';
        const cat = g.category || '';
        return `
        <article class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-md transition">
          <button class="group w-full text-start" data-game='${JSON.stringify(g).replace(/'/g,"&apos;")}'>
            <div class="relative">
              <img loading="lazy" src="${img}" alt="${title}" class="w-full aspect-video object-cover"/>
              ${cat?`<span class="absolute top-2 end-2 px-2 py-1 text-xs rounded-full bg-black/60 text-white">${cat}</span>`:''}
            </div>
            <div class="p-3">
              <h3 class="font-bold text-sm line-clamp-2">${title}</h3>
            </div>
          </button>
          <div class="px-3 pb-3 flex gap-2">
            <button class="flex-1 text-center px-3 py-2 rounded-xl bg-indigo-600 text-white text-sm font-semibold hover:bg-indigo-700" data-play='${JSON.stringify(g).replace(/'/g,"&apos;")}'>العب الآن</button>
          </div>
        </article>`;
      }).join('');

      // ربط التشغيل
      grid.querySelectorAll('[data-game],[data-play]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const data = JSON.parse(btn.getAttribute('data-game')||btn.getAttribute('data-play')).title ? JSON.parse((btn.getAttribute('data-game')||btn.getAttribute('data-play')).replace(/&apos;/g,"'")) : JSON.parse((btn.getAttribute('data-play')||btn.getAttribute('data-game')).replace(/&apos;/g,"'"));
          openPlayer(data);
        });
      });
    }

    async function load(){
      hideStatus();
      document.getElementById('pageLabel').textContent = `صفحة ${state.page}`;
      skeleton(state.perPage);
      const url = buildFeedUrl();
      try{
        const res = await fetch(url, {headers:{'Accept':'application/json'}});
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json().catch(()=>null);
        const items = Array.isArray(data) ? data : (data?.games || data?.result || data?.data || []);
        render(items);
      }catch(e){
        console.error(e);
        showStatus('تعذّر الجلب المباشر (قد يكون CORS). جرّب تفعيل البروكسي USE_PROXY واستخدم gm-feed-proxy.php على خادمك.', 'error');
        grid.innerHTML = '';
      }
      document.getElementById('prev').disabled = state.page<=1;
    }

    function openPlayer(g){
      const url = g.url || g.play || g.link || '#';
      document.getElementById('playerTitle').textContent = g.title||'';
      document.getElementById('openInNew').href = url;
      const frame = document.getElementById('gameFrame');
      frame.src = url; // رابط GameMonetize المباشر — تُنسب الأرباح حسب حسابك لأن المصدر من Feed حسابك
      const wrap = document.getElementById('player');
      wrap.classList.remove('hidden');
      wrap.classList.add('flex');
    }
    document.getElementById('closePlayer').addEventListener('click', ()=>{
      const wrap = document.getElementById('player');
      wrap.classList.add('hidden'); wrap.classList.remove('flex');
      document.getElementById('gameFrame').src = 'about:blank';
    });
    document.getElementById('player').addEventListener('click', (e)=>{ if(e.target.id==='player'){ document.getElementById('closePlayer').click(); }});

    // تحكم
    document.getElementById('apply').addEventListener('click', ()=>{
      localStorage.setItem('gm_feed', feedInput.value.trim());
      state.category = document.getElementById('category').value;
      state.platform = document.getElementById('platform').value;
      state.perPage = Number(document.getElementById('perPage').value||12);
      state.page = 1; load();
    });
    document.getElementById('reset').addEventListener('click', ()=>{
      localStorage.removeItem('gm_feed'); feedInput.value = DEFAULT_FEED;
      document.getElementById('category').value='';
      document.getElementById('platform').value='';
      document.getElementById('perPage').value='12';
      state.page=1; state.category=''; state.platform=''; state.perPage=12; load();
    });
    document.getElementById('prev').addEventListener('click', ()=>{ if(state.page>1){ state.page--; load(); }});
    document.getElementById('next').addEventListener('click', ()=>{ state.page++; load(); });

    // تشغيل أولي
    load();
  </script>
</body>
</html>
